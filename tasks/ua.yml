---
- name: install ubuntu advantage client
  apt:
    name: ubuntu-advantage-tools
    state: present
    update_cache: yes

- name: attach ubuntu advantage client
  command: ua attach "{{ common_ubuntu_advantage_token }}"
  register: command_result
  when: common_ubuntu_advantage_enabled
  ignore_errors: True

- name: validate ubuntu advantage client attached
  fail:
    msg: "Provided UA token is invalid"
  when:
    - "'Invalid token' in command_result.stderr"
    - common_ubuntu_advantage_test is undefined
